<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Projectile Motion Demo | Priscilla Johnston</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Poppins:wght@300;400;500;600&display=swap');

    :root {
      color-scheme: light;
      --gradient-start: #f8dcff;
      --gradient-middle: #f4c7ff;
      --gradient-end: #e9b7ff;
      --text-primary: #2e174b;
      --text-secondary: rgba(46, 23, 75, 0.68);
      --text-tertiary: rgba(46, 23, 75, 0.5);
      --surface: rgba(255, 255, 255, 0.72);
      --surface-card: rgba(255, 255, 255, 0.78);
      --surface-strong: rgba(255, 255, 255, 0.9);
      --surface-border: rgba(255, 255, 255, 0.7);
      --surface-border-strong: rgba(255, 255, 255, 0.78);
      --shadow-soft: rgba(62, 23, 124, 0.17);
      --shadow-medium: rgba(62, 23, 124, 0.15);
      --shadow-card: rgba(62, 23, 124, 0.14);
      --accent: #9757ff;
      --accent-soft: rgba(151, 87, 255, 0.12);
      --accent-border: rgba(151, 87, 255, 0.32);
    }

    :root[data-theme='dark'] {
      color-scheme: dark;
      --gradient-start: #110820;
      --gradient-middle: #1b0f33;
      --gradient-end: #301a4b;
      --text-primary: #f1ecff;
      --text-secondary: rgba(241, 236, 255, 0.72);
      --text-tertiary: rgba(241, 236, 255, 0.55);
      --surface: rgba(33, 26, 54, 0.82);
      --surface-card: rgba(30, 23, 51, 0.88);
      --surface-strong: rgba(28, 20, 48, 0.92);
      --surface-border: rgba(138, 120, 198, 0.32);
      --surface-border-strong: rgba(138, 120, 198, 0.38);
      --shadow-soft: rgba(12, 7, 22, 0.6);
      --shadow-medium: rgba(10, 6, 18, 0.48);
      --shadow-card: rgba(8, 5, 16, 0.45);
      --accent: #c6a7ff;
      --accent-soft: rgba(198, 167, 255, 0.18);
      --accent-border: rgba(198, 167, 255, 0.42);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      min-height: 100vh;
      font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      color: var(--text-primary);
      background: linear-gradient(120deg, var(--gradient-start), var(--gradient-middle), var(--gradient-end));
    }

    .heart-banner {
      padding: 18px 32px 24px;
      font-size: clamp(1.8rem, 3.5vw, 2.6rem);
      letter-spacing: 0.42em;
      display: flex;
      justify-content: center;
      align-items: center;
      color: rgba(255, 182, 236, 0.95);
      text-shadow: 0 0 20px rgba(255, 182, 236, 0.7);
      pointer-events: none;
      white-space: nowrap;
      overflow: hidden;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 32px 48px;
    }

    nav.menu {
      width: min(calc(100% - 48px), 1120px);
      display: flex;
      align-items: stretch;
      justify-content: space-between;
      gap: 18px;
      padding: 18px 26px;
      border-radius: 999px;
      backdrop-filter: blur(22px);
      background: var(--surface);
      border: 1.5px solid var(--surface-border);
      box-shadow: 0 24px 60px var(--shadow-soft);
    }

    .brand {
      font-family: 'Playfair Display', Georgia, serif;
      font-weight: 600;
      font-size: 1.35rem;
      letter-spacing: 0.08em;
      color: var(--text-primary);
      text-decoration: none;
    }

    .nav-actions {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .nav-links {
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
    }

    .nav-links a {
      font-size: 0.95rem;
      font-weight: 500;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      text-decoration: none;
      color: var(--text-tertiary);
      padding: 10px 18px;
      border-radius: 999px;
      transition: background 0.2s ease, color 0.2s ease;
    }

    .nav-links a:hover,
    .nav-links a:focus-visible,
    .nav-links a.active {
      background: rgba(151, 87, 255, 0.15);
      color: var(--text-primary);
      outline: none;
    }

    .theme-toggle {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border-radius: 999px;
      border: 1.5px solid var(--surface-border);
      background: var(--surface);
      color: var(--text-secondary);
      font-size: 0.9rem;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease, transform 0.2s ease;
    }

    .theme-toggle:hover,
    .theme-toggle:focus-visible {
      background: var(--accent-soft);
      color: var(--text-primary);
      border-color: var(--accent-border);
      transform: translateY(-1px);
      outline: none;
    }

    .theme-toggle-icon {
      font-size: 1.1rem;
    }

    .theme-toggle-label {
      font-size: 0.75rem;
      letter-spacing: 0.16em;
    }

    main {
      padding: 0 32px 96px;
      display: flex;
      justify-content: center;
    }

    .content {
      width: min(100%, 960px);
      padding: 56px 64px 72px;
      border-radius: 36px;
      background: var(--surface-card);
      border: 1px solid var(--surface-border-strong);
      box-shadow: 0 24px 65px var(--shadow-medium);
      display: grid;
      gap: 32px;
    }

    h1 {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: clamp(2.4rem, 5vw, 3.6rem);
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    p {
      font-size: 1.05rem;
      line-height: 1.85;
      color: var(--text-secondary);
    }

    .demo-panel {
      display: grid;
      gap: 20px;
    }

    .demo-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 18px;
      flex-wrap: wrap;
    }

    .demo-header span {
      font-size: 0.9rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--text-tertiary);
    }

    .demo-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .demo-controls {
      display: grid;
      gap: 12px;
      padding: 18px 22px;
      border-radius: 18px;
      background: var(--surface);
      border: 1px solid var(--surface-border);
      box-shadow: 0 12px 32px var(--shadow-card);
    }

    .control-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      font-size: 0.9rem;
      letter-spacing: 0.06em;
      color: var(--text-secondary);
    }

    .control-row label {
      font-weight: 600;
    }

    .control-row input[type="range"] {
      width: 100%;
    }

    .demo-summary {
      display: grid;
      gap: 10px;
      padding: 20px 24px;
      border-radius: 18px;
      background: var(--surface-card);
      border: 1px solid var(--surface-border-strong);
      box-shadow: 0 18px 45px var(--shadow-card);
      font-size: 0.98rem;
      color: var(--text-secondary);
    }

    .demo-summary strong {
      color: var(--text-primary);
      font-weight: 600;
    }

    .demo-play,
    .demo-reset {
      height: 44px;
      padding: 0 26px;
      border-radius: 999px;
      border: 1.5px solid rgba(151, 87, 255, 0.45);
      background: linear-gradient(135deg, rgba(151, 87, 255, 0.22), rgba(214, 182, 255, 0.6));
      color: var(--text-primary);
      letter-spacing: 0.14em;
      text-transform: uppercase;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .demo-play:hover,
    .demo-play:focus-visible,
    .demo-reset:hover,
    .demo-reset:focus-visible {
      transform: translateY(-2px);
      box-shadow: 0 16px 36px rgba(151, 87, 255, 0.28);
      outline: none;
    }

    .demo-play:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .demo-reset {
      background: rgba(255, 255, 255, 0.85);
      border-color: rgba(151, 87, 255, 0.35);
    }

    .demo-reset:hover,
    .demo-reset:focus-visible {
      box-shadow: 0 16px 32px rgba(151, 87, 255, 0.18);
    }

    .demo-canvas {
      width: 100%;
      max-width: 820px;
      height: auto;
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(239, 232, 255, 0.85), rgba(206, 190, 255, 0.6));
      border: 1px solid rgba(255, 255, 255, 0.7);
      box-shadow: inset 0 0 24px rgba(151, 87, 255, 0.18);
      margin: 0 auto;
      display: block;
    }

    .demo-explainer {
      margin-top: 8px;
      padding: 24px 28px;
      border-radius: 18px;
      background: rgba(255, 255, 255, 0.78);
      border: 1px solid rgba(255, 255, 255, 0.8);
      box-shadow: 0 18px 45px rgba(62, 23, 124, 0.12);
      display: grid;
      gap: 18px;
      font-size: 0.98rem;
      color: var(--text-secondary);
      line-height: 1.65;
    }

    .demo-explainer h3 {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 1.5rem;
      color: var(--text-primary);
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .demo-explainer ul {
      list-style: disc inside;
      display: grid;
      gap: 8px;
    }

    .demo-explainer code {
      font-family: 'Menlo', 'Fira Code', monospace;
      font-size: 0.92rem;
      color: var(--text-primary);
      background: var(--surface-strong);
      padding: 3px 6px;
      border-radius: 6px;
    }

    footer {
      padding: 36px;
      text-align: center;
      font-size: 0.85rem;
      color: var(--text-tertiary);
      letter-spacing: 0.2em;
      text-transform: uppercase;
    }

    @media (max-width: 820px) {
      header {
        padding: 0 20px 32px;
      }

      nav.menu {
        flex-direction: column;
        gap: 12px;
        align-items: stretch;
      }

      main {
        padding: 0 20px 72px;
      }

      .content {
        padding: 40px 28px 52px;
      }
    }

    @media (max-width: 520px) {
      .nav-actions {
        width: 100%;
        justify-content: space-between;
        flex-wrap: wrap;
      }
    }
  </style>
</head>

<body>
  <div class="heart-banner" aria-hidden="true"></div>
  <header>
    <nav class="menu" aria-label="Primary navigation">
      <a class="brand" href="index.html">Priscilla Johnston</a>
      <div class="nav-actions">
        <div class="nav-links">
          <a href="index.html">Home</a>
          <a href="about.html">About</a>
          <a href="projects.html">Projects</a>
          <a href="learning-demo.html" class="active">Projectile Motion Demo</a>
          <a href="restaurants.html">Restaurants</a>
          <a href="contact.html">Contact</a>
        </div>
        <button type="button" class="theme-toggle" data-theme-toggle aria-label="Toggle color theme">
          <span aria-hidden="true" class="theme-toggle-icon">â˜€</span>
          <span class="theme-toggle-label">Light mode</span>
        </button>
      </div>
    </nav>
  </header>

  <main>
    <section class="content">
      <h1>Projectile Motion Demo</h1>
      <p>Change the launch angle and initial speed to see how gravity shapes the flowerâ€™s flight. The numbers update with every throw so you can match what you observe on the canvas with the equations you learn in physics.</p>

      <div class="demo-panel">
        <div class="demo-header">
          <span id="demoHeading">30Â° launch angle beach throw</span>
          <div class="demo-actions">
            <button id="demoReset" class="demo-reset" type="button">Reset</button>
            <button id="demoPlay" class="demo-play" type="button">Play</button>
          </div>
        </div>
        <div class="demo-controls" aria-label="Projectile parameters">
          <div class="control-row">
            <label for="angleControl">Launch angle</label>
            <output id="angleValue" for="angleControl">30Â°</output>
          </div>
          <input id="angleControl" type="range" min="10" max="70" value="30" step="1" aria-label="Launch angle in degrees">
          <div class="control-row">
            <label for="speedControl">Initial speed</label>
            <output id="speedValue" for="speedControl">8.0 m/s</output>
          </div>
          <input id="speedControl" type="range" min="4" max="15" value="8" step="0.5" aria-label="Initial velocity in meters per second">
        </div>
        <div class="demo-summary" aria-live="polite">
          <div><strong>Î”x (horizontal):</strong> <span id="summaryDx">0.0 m</span></div>
          <div><strong>Launch height:</strong> <span id="summaryLaunchHeight">0.0 m</span></div>
          <div><strong>Max height:</strong> <span id="summaryMaxHeight">0.0 m</span></div>
          <div><strong>Flight time:</strong> <span id="summaryTime">0.00 s</span></div>
        </div>
        <canvas id="demoCanvas" class="demo-canvas" width="920" height="420" aria-label="Animated diagram of a girl tossing a beach ball"></canvas>
      </div>

      <div class="demo-explainer">
        <div>
          <h3>Projectile Motion</h3>
          <p>Projectile motion describes how an object moves when the only force acting on it is gravity. Once the flower leaves the throwerâ€™s hand, its horizontal velocity stays constant while gravity accelerates it downwardâ€”combining to form a smooth parabolic arc.</p>
        </div>
        <div>
          <strong>Key equations</strong>
          <ul>
            <li>Time of flight: <code>T = (v Â· sinÎ¸ + âˆš((v Â· sinÎ¸)Â² + 2g Â· h)) / g</code></li>
            <li>Horizontal range: <code>Î”x = v Â· cosÎ¸ Â· T</code></li>
            <li>Maximum height: <code>H = h + (vÂ² Â· sinÂ²Î¸) / (2g)</code></li>
            <li>Vertical position: <code>y(t) = h + v Â· sinÎ¸ Â· t âˆ’ Â½ g tÂ²</code></li>
          </ul>
          <p>Adjusting the angle Î¸ or speed v changes both the flight time and the range. Launch height h shifts the entire path upward, which is why the flower starts above the sand.</p>
        </div>
      </div>
    </section>
  </main>

  <footer>
    Â© <span id="year"></span> Priscilla Johnston. Crafted with curiosity and care.
  </footer>

  <script src="scripts/theme.js"></script>
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    const heartBanner = document.querySelector('.heart-banner');

    function renderHeartBanner() {
      if (!heartBanner) return;
      const availableWidth = heartBanner.clientWidth || window.innerWidth;
      heartBanner.textContent = 'ðŸ’–';
      const heartWidth = heartBanner.scrollWidth || 1;
      const count = Math.max(5, Math.floor(availableWidth / heartWidth));
      heartBanner.textContent = 'ðŸ’–'.repeat(count);
    }

    renderHeartBanner();
    window.addEventListener('resize', renderHeartBanner);

    (function () {
      const canvas = document.getElementById('demoCanvas');
      const playButton = document.getElementById('demoPlay');
      const angleSlider = document.getElementById('angleControl');
      const speedSlider = document.getElementById('speedControl');
      const angleValue = document.getElementById('angleValue');
      const speedValue = document.getElementById('speedValue');
      const summaryDx = document.getElementById('summaryDx');
      const summaryLaunchHeight = document.getElementById('summaryLaunchHeight');
      const summaryMaxHeight = document.getElementById('summaryMaxHeight');
      const summaryTime = document.getElementById('summaryTime');
      const resetButton = document.getElementById('demoReset');
      const heading = document.getElementById('demoHeading');
      if (!canvas || !playButton || !angleSlider || !speedSlider || !resetButton || !summaryDx || !summaryLaunchHeight || !summaryMaxHeight || !summaryTime) return;

      const ctx = canvas.getContext('2d');
      const width = canvas.width;
      const height = canvas.height;
      const groundY = height - 46;
      const launchX = Math.round(width * 0.16);
      const rightMargin = 64;
      const gravityMeters = 9.81;
      const maxLaunchSpeedMeters = Number(speedSlider.max);
      const optimalRangeAngle = Math.PI / 4;
      const maxRangeMeters =
        (maxLaunchSpeedMeters * maxLaunchSpeedMeters * Math.sin(2 * optimalRangeAngle)) / gravityMeters;
      const pixelsPerMeter = Math.min((width - rightMargin - launchX) / maxRangeMeters, 36);
      const gravity = gravityMeters * pixelsPerMeter;
      const launchHeightMeters = 2.5; // person release point in meters
      const launchHeightPixels = launchHeightMeters * pixelsPerMeter;
      const launchPoint = { x: launchX, y: groundY - launchHeightPixels };
      const maxRangeMetersOnCanvas = (width - rightMargin - launchPoint.x) / pixelsPerMeter;
      const ball = {
        x: launchPoint.x,
        y: launchPoint.y,
        radius: Math.max(12, Math.round(pixelsPerMeter * 0.38)),
        vx: 0,
        vy: 0
      };

      let launchSpeedMeters = Number(speedSlider.value);
      let launchSpeed = launchSpeedMeters * pixelsPerMeter;
      let angle = (Number(angleSlider.value) * Math.PI) / 180;
      let animationId = null;
      let prevTimestamp = null;
      let running = false;
      let lastDistance = null;
      const highlightThickness = Math.max(2.5, pixelsPerMeter * 0.08);

      function velocityComponents() {
        return {
          x: launchSpeed * Math.cos(angle),
          y: -launchSpeed * Math.sin(angle),
        };
      }

      function drawBackground() {
        const sky = ctx.createLinearGradient(0, 0, 0, height);
        sky.addColorStop(0, 'rgba(240, 232, 255, 0.95)');
        sky.addColorStop(1, 'rgba(215, 194, 255, 0.85)');
        ctx.fillStyle = sky;
        ctx.fillRect(0, 0, width, height);

        ctx.fillStyle = 'rgba(164, 216, 255, 0.5)';
        const waterTop = groundY - Math.round(pixelsPerMeter * 1.8);
        const waterHeight = Math.round(pixelsPerMeter * 0.9);
        ctx.fillRect(0, waterTop, width, waterHeight);

        const sandTop = groundY - Math.round(pixelsPerMeter * 0.9);
        const sand = ctx.createLinearGradient(0, sandTop, 0, height);
        sand.addColorStop(0, 'rgba(255, 233, 199, 0.9)');
        sand.addColorStop(1, 'rgba(240, 200, 160, 0.95)');
        ctx.fillStyle = sand;
        ctx.fillRect(0, sandTop, width, height - sandTop);

        drawAngleGuide();
        drawGirl();
      }

      function drawGirl() {
        const color = '#ff4fb0';
        const baseY = groundY;
        const figureX = launchPoint.x - pixelsPerMeter * 0.95;
        const headRadius = Math.max(8, pixelsPerMeter * 0.18);
        const shoulderY = launchPoint.y - pixelsPerMeter * 0.12;
        const headCenterY = shoulderY - headRadius - pixelsPerMeter * 0.08;
        const hipY = baseY - pixelsPerMeter * 0.78;
        const rearFootX = figureX - pixelsPerMeter * 0.32;
        const frontFootX = figureX + pixelsPerMeter * 0.28;
        const elbowX = figureX + pixelsPerMeter * 0.25;
        const elbowY = shoulderY - pixelsPerMeter * 0.24;
        const backHandX = figureX - pixelsPerMeter * 0.55;
        const backHandY = shoulderY + pixelsPerMeter * 0.48;
        const handX = launchPoint.x - ball.radius * 0.65;
        const handY = launchPoint.y - ball.radius * 0.4;
        const lineWidth = Math.max(3, pixelsPerMeter * 0.09);

        ctx.save();
        ctx.lineCap = 'round';
        ctx.strokeStyle = color;
        ctx.lineWidth = lineWidth;
        ctx.beginPath();
        ctx.arc(figureX, headCenterY, headRadius, 0, Math.PI * 2);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(figureX, shoulderY);
        ctx.lineTo(figureX, hipY);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(figureX, hipY);
        ctx.lineTo(rearFootX, baseY);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(figureX, hipY);
        ctx.lineTo(frontFootX, baseY);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(figureX, shoulderY + pixelsPerMeter * 0.12);
        ctx.lineTo(backHandX, backHandY);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(figureX, shoulderY);
        ctx.lineTo(elbowX, elbowY);
        ctx.lineTo(handX, handY);
        ctx.stroke();

        ctx.beginPath();
        ctx.arc(handX + ball.radius * 0.3, handY + ball.radius * 0.3, Math.max(3, ball.radius * 0.35), 0, Math.PI * 2);
        ctx.stroke();

        ctx.restore();
      }

      function drawAngleGuide() {
        const guideLength = Math.min(width - launchPoint.x - rightMargin, pixelsPerMeter * 5);
        ctx.strokeStyle = 'rgba(255, 154, 214, 0.6)';
        ctx.lineWidth = highlightThickness;
        ctx.setLineDash([6, 10]);
        ctx.beginPath();
        ctx.moveTo(launchPoint.x, launchPoint.y);
        ctx.lineTo(launchPoint.x + guideLength, launchPoint.y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(launchPoint.x, launchPoint.y);
        ctx.lineTo(launchPoint.x + guideLength * Math.cos(angle), launchPoint.y - guideLength * Math.sin(angle));
        ctx.stroke();
        ctx.setLineDash([]);

        const arcRadius = Math.max(24, pixelsPerMeter * 0.9);
        ctx.fillStyle = 'rgba(255, 154, 214, 0.85)';
        ctx.beginPath();
        ctx.moveTo(launchPoint.x + arcRadius, launchPoint.y);
        ctx.arc(launchPoint.x, launchPoint.y, arcRadius, 0, -angle, true);
        ctx.closePath();
        ctx.fill();

        ctx.fillStyle = '#3d1f5a';
        ctx.font = `600 ${Math.max(14, pixelsPerMeter * 0.36)}px 'Poppins', sans-serif`;
        ctx.save();
        ctx.translate(launchPoint.x + arcRadius + 10, launchPoint.y - arcRadius * 0.45);
        ctx.rotate(-angle / 2);
        ctx.fillText(`${(angle * 180 / Math.PI).toFixed(0)}Â°`, 0, 0);
        ctx.restore();
      }

      function drawScene(ballX, ballY) {
        ctx.clearRect(0, 0, width, height);
        drawBackground();

        ctx.save();
        ctx.translate(ballX, ballY);
        const spinAngle = (Date.now() / 150) % (Math.PI * 2);
        ctx.rotate(spinAngle);
        ctx.font = `${ball.radius * 2.1}px 'Segoe UI Emoji','Apple Color Emoji',sans-serif`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('ðŸŒ¸', 0, 0);
        ctx.restore();

        if (lastDistance !== null) {
          const visibleRange = Math.min(lastDistance, maxRangeMetersOnCanvas);
          const landingX = launchPoint.x + visibleRange * pixelsPerMeter;
          ctx.strokeStyle = 'rgba(63, 30, 96, 0.7)';
          ctx.lineWidth = highlightThickness;
          ctx.beginPath();
          ctx.moveTo(launchPoint.x, groundY - highlightThickness * 1.5);
          ctx.lineTo(landingX, groundY - highlightThickness * 1.5);
          ctx.stroke();

          ctx.fillStyle = 'rgba(63, 30, 96, 0.9)';
          ctx.font = `600 ${Math.max(16, pixelsPerMeter * 0.45)}px 'Poppins', sans-serif`;
          ctx.textAlign = 'center';
          ctx.fillText(
            `${lastDistance.toFixed(1)} m`,
            launchPoint.x + (landingX - launchPoint.x) / 2,
            groundY - highlightThickness * 6,
          );

          const arrowSize = Math.max(8, pixelsPerMeter * 0.26);
          ctx.beginPath();
          ctx.moveTo(launchPoint.x, groundY - highlightThickness * 1.5);
          ctx.lineTo(launchPoint.x + arrowSize, groundY - highlightThickness * 3.4);
          ctx.lineTo(launchPoint.x + arrowSize, groundY - highlightThickness * -0.4);
          ctx.closePath();
          ctx.fill();

          ctx.beginPath();
          ctx.moveTo(landingX, groundY - highlightThickness * 1.5);
          ctx.lineTo(landingX - arrowSize, groundY - highlightThickness * 3.4);
          ctx.lineTo(landingX - arrowSize, groundY - highlightThickness * -0.4);
          ctx.closePath();
          ctx.fill();
        }
      }

      function animate(timestamp) {
        if (prevTimestamp === null) {
          prevTimestamp = timestamp;
          animationId = requestAnimationFrame(animate);
          return;
        }

        const deltaMs = timestamp - prevTimestamp;
        prevTimestamp = timestamp;
        const dt = Math.min(Math.max(deltaMs / 1000, 0), 0.05);

        ball.vy += gravity * dt;
        ball.x += ball.vx * dt;
        ball.y += ball.vy * dt;

        if (ball.x > launchPoint.x + maxRangeMetersOnCanvas * pixelsPerMeter) {
          ball.x = launchPoint.x + maxRangeMetersOnCanvas * pixelsPerMeter;
        }

        if (ball.y + ball.radius >= groundY) {
          ball.y = groundY - ball.radius;
          const stats = computeTrajectoryMetrics();
          lastDistance = stats.range;
          const clampedRange = Math.min(stats.range, maxRangeMetersOnCanvas);
          ball.x = launchPoint.x + clampedRange * pixelsPerMeter;
          updateSummary(stats);
          drawScene(ball.x, ball.y);
          stopAnimation();
          return;
        }

        drawScene(ball.x, ball.y);
        animationId = requestAnimationFrame(animate);
      }

      function startAnimation() {
        if (running) return;
        running = true;
        playButton.disabled = true;
        prevTimestamp = null;
        lastDistance = null;
        const velocity = velocityComponents();
        ball.x = launchPoint.x;
        ball.y = launchPoint.y;
        ball.vx = velocity.x;
        ball.vy = velocity.y;
        drawScene(ball.x, ball.y);
        animationId = requestAnimationFrame(animate);
      }

      function resetScene() {
        angle = (Number(angleSlider.value) * Math.PI) / 180;
        launchSpeedMeters = Number(speedSlider.value);
        launchSpeed = launchSpeedMeters * pixelsPerMeter;
        angleValue.textContent = `${angleSlider.value}Â°`;
        speedValue.textContent = `${launchSpeedMeters.toFixed(1)} m/s`;
        if (heading) {
          heading.textContent = `${angleSlider.value}Â° launch angle beach throw`;
        }
        lastDistance = null;
        const velocity = velocityComponents();
        ball.x = launchPoint.x;
        ball.y = launchPoint.y;
        ball.vx = velocity.x;
        ball.vy = velocity.y;
        drawScene(ball.x, ball.y);
        updateSummary(computeTrajectoryMetrics());
      }

      playButton.addEventListener('click', startAnimation);
      angleSlider.addEventListener('input', () => {
        if (running) stopAnimation();
        resetScene();
      });
      speedSlider.addEventListener('input', () => {
        if (running) stopAnimation();
        resetScene();
      });
      resetButton.addEventListener('click', () => {
        stopAnimation();
        angleSlider.value = '30';
        speedSlider.value = '8';
        resetScene();
      });

      resetScene();

      window.addEventListener('beforeunload', () => {
        if (animationId) cancelAnimationFrame(animationId);
      });

      function computeTrajectoryMetrics() {
        const g = gravityMeters;
        const theta = angle;
        const vx = launchSpeedMeters * Math.cos(theta);
        const vy = launchSpeedMeters * Math.sin(theta);
        const discriminant = vy * vy + 2 * g * launchHeightMeters;
        const flightTime = (vy + Math.sqrt(Math.max(discriminant, 0))) / g;
        const range = Math.max(0, vx * flightTime);
        const maxHeight = launchHeightMeters + (vy * vy) / (2 * g);

        return { range, flightTime, maxHeight, launchHeight: launchHeightMeters };
      }

      function updateSummary(stats) {
        const { range, flightTime, maxHeight, launchHeight: launchMeters } = stats;
        summaryDx.textContent = `${range.toFixed(1)} m`;
        summaryLaunchHeight.textContent = `${launchMeters.toFixed(1)} m`;
        summaryMaxHeight.textContent = `${maxHeight.toFixed(1)} m`;
        summaryTime.textContent = `${flightTime.toFixed(2)} s`;
      }

      function stopAnimation() {
        if (animationId) cancelAnimationFrame(animationId);
        animationId = null;
        running = false;
        prevTimestamp = null;
        playButton.disabled = false;
      }
    })();
  </script>
</body>

</html>
